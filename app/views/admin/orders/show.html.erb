<div class="container">
  <div class="row">
    <div class="col-10">
      <p id="notice"></p>
      <h4>注文履歴詳細</h4>
      <table class="table table-borderless">
    <h4>注文履歴詳細</h4>
    <table>
    　<div class="form-grop">
        <label for="order-name">購入者</label>
        <%= link_to admin_member_path(@member), class: "btn-link" do %>
          <%= @order.member.last_name %><%= @order.member.first_name %>
        <% end %>
      </div>
      <div class="form-grop">
        <label for="order-datetime">注文日</label>
        <%= @order.created_at %>
      </div>
      <div class="form-grop">
        <label for="order-address">配送先</label>
        <%= @order.postal_code %><%= @order.address %><br>
        <%= @order.name %>
      </div>
      <div class="form-grop">
        <label for="order-pay">支払方法</label>
        <%= @order.payment_method %>
      </div>
      <div class="form-grop">
        <label for="order-status">注文ステータス</label>
        <%= select :status,:name,Order.statuses.keys.to_a %>
        <%= select :status,:name,Order.statuses.values.to_a %>
        <%= link_to "更新", class: "btn btn-success" %>
      </div>
    </table>
  </div>

  <div class="row">
    <div class="col-md-8">
      <thead>
        <tr>
          <th><strong>購入者</strong></th>
          <td><%= @order.member.last_name %><%= @order.member.first_name %></td>
        </tr>
        <tr>
          <% @order_products.each do |order_product| %>
          <th><strong>注文日</strong></th>
          <td><%= @order.created_at %></td>
        </tr>
        <tr>
          <th><strong>配送先</strong></th>
          <td>
            <%= @order.postal_code %><%= @order.address %>
            <%= @order.name %>
          </td>
        </tr>
        <tr>
          <th><strong>支払方法</strong></th>
          <td><%= @order.payment_method %></td>
        </tr>
        <tr>
          <th><strong>注文ステータス</strong></th>
          <td>
            <%=  form_with model: @order ,url: admin_order_path(@order) ,local: true do |f| %>
            <%= f.select :status,Order.statuses.keys.to_a %>
            <%= f.submit "更新", class: "btn btn-success" %>
            <% end %>
          </td>
        </tr>
      </table>
      <table class="table">
        <thead class="thead-light">
          <tr>
            <th>商品名</th>
            <th>単価(税込)</th>
            <th>数量</th>
            <th>小計</th>
            <th>制作ステータス</th>
          </tr>
        </thead>
        <tbody>
          <% @order_products.each do |order_product| %>
          <tr>
            <td><%= order_product.product.name %></td>
            <td>
              <% order_product.price  %>
            </td>
            <td><%= order_products.quantity %></td>
            <td></td>
            <td><%= order.production_status %></td>
            <td><%= order_product.quantity %></td>
            <td><%= order_product.price %></td>
            <td>
              <%=  form_with model:[@order,order_product] ,url: admin_order_order_product_path(@order.id,order_product.id),method: :patch ,local: true do |f| %>
              <%= f.select :production_status,OrderProduct.production_statuses.keys.to_a %>
              <%= f.submit "更新", class: "btn btn-success" %>
              <% end %>
            </td>
          </tr>
          <% end %>
        </tbody>
      </table>
      <table class="table table-borderless">
        <tr>
          <th><strong>商品合計</strong></th>
          <td>￥<%= @order.total_payment - @order.shipping_price  %></td>
        </tr>
        <tr>
          <th><strong>送料</strong></th>
          <td>￥<%= @order.shipping_price %></td>
        </tr>
        <tr>
          <th><strong>請求金額合計</strong></th>
          <td>￥<%= @order.total_payment %></td>
        </tr>
      </tbody>
    </div>

    <div class="col-md-3">
      <div class="form-grop">
        <%= f.label :"商品合計" %>
        <% @total = @product_price * cart.quantity.to_i %>
        ￥<%= @total.floor.to_s(:delimited) %>
        <!--合計金額の計算-->
        <% @sum += @total  %>
      </div>
      <div class="form-grop">
        <%= f.label :"送料" %>
        <%= @order.shipping_price %> 円
      </div>
      <div class="form-grop">
        <%= f.label :"請求金額合計" %>
        <%= @order.total_payment + @order.shipping_price %>円
      </div>
      </table>
    </div>
  </div>
</div>
